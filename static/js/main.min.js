/*! nanshacity_v2 author:JavieChan create:2016-01-11 updated:2016-06-07 */
function acAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"acs/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d()})}function pnUserAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"pn/users/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d()})}function billAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"paypolicy/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d()})}function billWebTypeFunc(a,b,c,d){$.ajax({method:a,url:proUrl+"webtype/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d()})}function resAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"resources/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d()})}function fiberAjax(a,b,c,d){$.ajax({method:a,url:proUrl+"fibers/",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(a){console.log(a),"function"==typeof d&&d()})}function billFunc(a,b,c){$.ajax({method:"get",url:proUrl+"payrecord/stat",data:a,dataType:"json"}).done(function(a){b(a)}).fail(function(a){console.log(a),"function"==typeof c&&c()})}function payFunc(a,b,c){$.ajax({method:"put",url:proUrl+"payaccount/",data:a,dataType:"json"}).done(function(a){b(a)}).fail(function(a){console.log(a),"function"==typeof c&&c()})}function apAjax(a,b,c){$.ajax({method:"put",url:proUrl+"aps/",data:a,dataType:"json"}).done(function(a){b(a)}).fail(function(a){console.log(a),"function"==typeof c&&c()})}function ajaxImg(a,b,c){c.parent().find(".loading").show(),$.ajaxFileUpload({url:proUrl+"image",secureuri:!1,fileElementId:a,dataType:"json",success:function(a){var c=$("#"+b);c.attr("src",a.imgurl),c.parent().show(),c.parent().prev().find(".loading").hide(),c.parent().prev().find("input[type=hidden]").val(a.imgurl)},error:function(a,b,c){console.log(c)}})}function uploadfile(a){var b=$("#"+a);b.parent().find(".loading").show(),$.ajaxFileUpload({url:"/file",secureuri:!1,fileElementId:a,dataType:"json",success:function(b,c){var d=$("#"+a);d.parent().find(".loading").hide(),d.parent().find("i.errormsg").remove(),d.parent().find("em").text(b.url),d.parent().find("input[type=hidden]").val(b.url)},error:function(a,b,c){console.log(c)}})}function getParam(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),c=window.location.search.substr(1).match(b);return null!=c?decodeURIComponent(c[2].replace(/\+/g,"+")):null}function getStat(a,b){var c=[],d=[],e=[],f=[];return $.each(a,function(a,g){0==b?c.push(a.substr(-2,2)):c.push(a),d.push(g.conns),e.push(g.onlines),f.push(g.offlines)}),{a:c,b:d,c:e,d:f}}function dateSub(a){return a.substr(-2,2)}function checkInput(a){var b=a.find("input.shouldVerify");return b.each(function(a,b){$(b).hasClass("checkFile")&&""==$(b).siblings("em").text()?inputError("*上传文件",b):""==$(b).val()||null==$(b).val()?$(b).hasClass("error")||inputError("*必填",b):$(b).hasClass("error")||inputError("",b)}),a.find("input[type=text].shouldVerify.error").length}function checkIpu(a){var b=a.find("input"),c=0;return b.each(function(a,b){(""==$(b).val()||null==$(b).val())&&c++}),c}function inputError(a,b){if(""==a)$(b).parent().find("i.errormsg").remove(),$(b).removeClass("error");else{var c='<i class="errormsg">'+a+"</i>";$(b).parent().append(c),$(b).addClass("error")}}function lastStr(a){var b=a.split(",");return console.log(b[b.length-1]),b[b.length-1]}function changeSelectFunc(id,val){var func=eval("change"+id);return func(val)}function changevendor(a){var b=$.trim(a);if("hanming"==b||"Hanming"==b)var c='<i class="vendor hanming"></i>';else if("ruijie"==b||"Ruijie"==b)var c='<i class="vendor ruijie"></i>';else if("h3c"==b||"H3C"==b)var c='<i class="vendor h3c"></i>';else if("huawei"==b||"Huawei"==b)var c='<i class="vendor huawei"></i>';else if("xinrui"==b||"Xinrui"==b)var c='<i class="vendor xinrui"></i>';else if("shenxinfu"==b||"Shenxinfu"==b)var c='<i class="vendor shenxinfu"></i>';else var c=b;return c}function changepri(a){return 0==a?"否":"是"}function addLoad(){if(0==$(".wrapLoad").length){var a='<div class="wrapLoad"><i></i><p>正在加载中...</p></div>';$("body").append(a)}}function removeLoad(){$(".wrapLoad").remove()}!function(a){var b=!0,c=-1,d="";a.fn.extend({selectSimple:function(a,d){var g=this,h=g.offset();(c!=a||b)&&(e(f(d),h,a),c=a)}}),a(document).on("click",".autoInput",function(b){var c=a(this).parent().parent().index(),e=a(this);""==d?a.getJSON("/resources/list",function(a){200==a.code&&(d=a,e.selectSimple(c,d))}):e.selectSimple(c,d)}),a(document).on("click",".select_item",function(){var b=a(this).parent().parent().attr("data-hid"),c=a("#aplist table tr").eq(b),d=a(this).attr("data-locate"),e=a(this).attr("data-bind-name");if(b>0?(c.find(".autoInput em").text(e),c.find(".autoInput").attr("title",e),c.find(".autoInput").attr("data-locate",d)):(a(".toolbox .autoInput em").text(e),a(".toolbox .autoInput").attr("title",e),a(".toolbox .autoInput").attr("data-locate",d)),0==a(this).parent().parent().attr("data-hid")){var f={resource:a(".toolbox .autoInput").attr("data-locate"),keyword:a(".toolbox .search input").data("search"),page:1,page_size:50};a("#aplist .toolbox select").each(function(b,c){var d=a(c).data("name");f[d]=a(c).val()}),a.ajax({method:"get",url:proUrl+"aps/list",data:f,dataType:"json"}).done(function(b){200==b.code?(a("#aplist table").html(b.table),a("#aplist .page").html(b.paginate),a("#aplist").page({url:proUrl+"aps/list",deSearch:!0})):console.log(b)}).fail(function(){console.log("翻页失败！")})}a(".autoSelect").remove()}),a("body, html").click(function(){a(".autoSelect").length>0?(a(".autoSelect").remove(),b=!1):b=!0});var e=function(b,c,d){var e='<div class="autoSelect" data-hid="'+d+'"><div class="autoOption">'+b+"</div></div>";a("body").append(e),a(".autoSelect").css({top:c.top+32+"px",left:c.left+"px"}).show()},f=function(a){var b="";return a.resources.map(function(a){b+=g(a)}),b},g=function(a){return'<div class="select_item" data-locate="'+a._location+'" data-bind-id="'+a.id+'" data-bind-name="'+a.name+'">'+a.id+" / "+a.name+"</div>"}}(jQuery),window.proUrl="/",window.nsmUrl="http://nsm.cniotroot.cn",window.cmsUrl="http://cms.cniotroot.cn",$(function(){$("#totallist").page({url:proUrl+"users/list"}),$("#aplist").page({url:proUrl+"aps/list"}),$("#apslist").page({url:proUrl+"aps/list",location:$("#location").val()}),$("#billlist").page({url:proUrl+"payrecord",location:$("#location").val()}),$("#userlist").page({url:proUrl+"pn/users/",location:$("#location").val(),mask:$("#userlist .adsnav li.on").data("mask")}),$("#userlist").pageSearch({url:proUrl+"pn/users/",location:$("#location").val(),mask:$("#userlist .adsnav li.on").data("mask")}),$("#billlist").pageSearch({url:proUrl+"payrecord/search",location:$("#location").val(),pageUrl:proUrl+"payrecord"}),$("#aplist").pageSearch({url:proUrl+"aps/list",deSearch:!0}),$("#apslist").pageSearch({url:proUrl+"aps/list",location:$("#location").val(),deSearch:!0})}),$(function(){$(document).on("click",".ns_subtab .more",function(){var a=$(this).parent().siblings(".areabox"),b=a.find(".magnet").length;a.hasClass("showall")?(a.css("height","63px").removeClass("showall"),$(this).html('更多<i class="aDwn"></i>')):(a.css("height",63*(Math.floor(b/4)+1)+"px").addClass("showall"),$(this).html('收起<i class="aUp"></i>'))}),$(document).on("click",".ns_subtab .search button",function(){var a=$.trim($(this).siblings("input").val()),b=0;return $(".magnet").each(function(c,d){var e=$(d).find(".name").text();""==a?($(d).show(),b++):e.indexOf(a)>=0?($(d).show(),b++):$(d).hide()}),0==b?($(".magnet").show(),$(".ns_subtab .more").show(),alert("没有匹配项！"),!1):void(b>4?$(".ns_subtab .more").show():$(".ns_subtab .more").hide())}),$(document).on("mouseenter",".pwdtip",function(){var a=$(this).data("tip"),b=$(this).offset().top,c=$(this).offset().left,d='<span class="tip">'+a+"</span>";$("body").append(d);var e=$(".tip").outerWidth(),f=$(".tip").outerHeight();$(".tip").css({left:c-e/2+"px",top:b-f-5+"px"})}),$(document).on("mouseleave",".pwdtip",function(){$(".tip").remove()}),$(document).on("click","#AP001",function(){$(this).next("div").toggle()}),$(document).on("click",".preventUrl",function(a){a.preventDefault(),alert("只有在本地服务器可以使用本功能！")}),1==$(".tabbox").length?$(".tabbox").css("min-height","833px"):$(".tabbox:last-child").css("padding-bottom","90px"),$(".table_td:even").css("background","#eff8f9"),$(".tabnav li:last").hide(),$(document).on("click",".checklist dd",function(){$(this).find("i").toggleClass("on")}),$(document).on("click",".uncheck_s",function(a){$(this).toggleClass("on"),a.stopPropagation()}),$(document).on("click",".checktabs dd",function(){$(this).addClass("on").siblings().removeClass("on")}),$(document).on("focus",".matchVerify",function(){inputError("",this)}),$(document).on("blur",".matchVerify",function(){var a=$.trim($(this).val());$(this).hasClass("checkPhone")&&!/^1[0-9]{10}$/.test(a)?inputError("*输入有效的手机号",this):$(this).hasClass("checkFloat")?/^[0-9]+([.][0-9]+){0,1}$/.test(a)?$(this).val(a.match(/^\d+(\.\d{1,2})?/)[0]):inputError("*输入有效值",this):$(this).hasClass("checkInt")?/^[0-9]+$/.test(a)?$(this).val(a.match(/[1-9][0-9]+/)[0]):inputError("*输入整数",this):$(this).hasClass("checkEng")?/^[0-9A-Za-z_\-]*$/.test(a)||inputError("*不能是中文",this):$(this).hasClass("checkMac")&&(/^[a-fA-F\d]{2}:[a-fA-F\d]{2}:[a-fA-F\d]{2}:[a-fA-F\d]{2}:[a-fA-F\d]{2}:[a-fA-F\d]{2}$/.test(a)||inputError("*格式不正确",this))}),$(document).on("click",".errormsg",function(){$(this).parent().find("input[type=text]").trigger("focus")}),$(document).on("click",".adsnav li",function(){var a=$(this).position().left;$(".adskpi i").css("left",a+35+"px")}),$(document).on("click","#sens .addbtn",function(){$("#modalSens").modal("open");var a=$("#location").val();$.ajax({method:"get",url:proUrl+"aps?location="+a+"&page_size=-1",dataType:"json"}).done(function(a){if(200==a.code){for(var b="",c=0,d=a.aps.length;d>c;c++){var e='<dd><i class="uncheck_s"></i><em data-id="'+a.aps[c].id+'">'+a.aps[c].name+"</em></dd>";b+=e}$(".checklist dl").append(b)}else alert("获取AP列表失败")})}),$(document).on("click","#modalSens, #modalSens .closed",function(){$(".checklist dl").empty(),$(".checktabs dd:eq(2)").addClass("on").siblings().removeClass("on"),$("#modalSens").modal("closed")}),$(document).on("click","#modalSens .add",function(){var a=[],b=$("#location").val(),c=$("#unit dd.on").attr("data-value");return $(".checklist dd i").each(function(b,c){$(c).hasClass("on")&&a.push($(c).next("em").attr("data-id"))}),checkInput($(this).parent().parent())>0?!1:void(0==a.length?$(".msg").text("至少选择一个AP"):($(".msg").text(""),$.ajax({method:"post",url:proUrl+"sens",dataType:"json",data:{page_size:-1,location:b,group:$("input[name=group]").val(),aps:a.join(","),unit:c,scale:$("input[name=scale]").val(),warning:$("input[name=warning]").val()}}).done(function(a){200==a.code&&(window.location.href="/projectsens.html?location="+b)})))}),$(document).on("click","#sens table tr:gt(0)",function(){var a=$("#location").val(),b=$(this).attr("group_id");window.location.href="/projectsensgroup.html?location="+a+"&group_id="+b}),$(document).on("click","#sensRoom .addbtn",function(){$("#modalAP").modal("open");var a=[],b=$("#location").val();$(".sensap em").each(function(b,c){a.push($(c).attr("data-ap-id"))}),$.ajax({method:"get",url:proUrl+"aps?location="+b,dataType:"json",success:function(b){if(200==b.code){for(var c="",d=0,e=b.aps.length;e>d;d++){if($.inArray(b.aps[d].id,a)>=0)var f='<dd><i class="uncheck_s on"></i><em data-id="'+b.aps[d].id+'">'+b.aps[d].name+"</em></dd>";else var f='<dd><i class="uncheck_s"></i><em data-id="'+b.aps[d].id+'">'+b.aps[d].name+"</em></dd>";c+=f}$(".checklist dl").append(c)}else alert("获取AP列表失败")}})}),$(document).on("click","#modalAP, #modalAP .closed",function(){$(".checklist dl").empty(),$("#modalAP").modal("closed")}),$(document).on("click","#modalAP .add",function(){var a=[],b=[],c=$("#location").val(),d=$("#groupId").val();$(".checklist dd i").each(function(c,d){if($(d).hasClass("on")){var e={};a.push($(d).next("em").attr("data-id")),e.id=$(d).next("em").attr("data-id"),e.name=$(d).next("em").text(),b.push(e)}}),0==a.length?$(".msg").text("至少选择一个AP"):($(".msg").text(""),$.ajax({method:"post",url:proUrl+"sens/aps?page_size=-1",dataType:"json",data:{location:c,group_id:d,aps:a.join(",")},success:function(a){if(200==a.code){$("#modalAP").modal("closed"),$(".sensContent .sensap").remove();for(var c="",d=0,e=b.length;e>d;d++){var f='<div class="sensap"><div><label>AP名称：</label><span>'+b[d].name+'</span></div><em data-ap-id="'+b[d].id+'">删除</em></div>';c+=f}$(".sensContent").append(c)}}}))}),$(document).on("click",".sensap em",function(){var a=$("#location").val(),b=$("#groupId").val(),c=$(this).attr("data-ap-id"),d=$(this);confirm("确定要删除吗？")&&$.ajax({method:"delete",url:proUrl+"sens/aps",dataType:"json",data:{location:a,group_id:b,ap_id:c},success:function(a){200==a.code&&d.parent().remove()}})}),$(document).on("click","#custom",function(){$("#modalCustom").modal("open")}),$(document).on("click","#modalCustom, #modalCustom .closed",function(){$("#modalCustom").modal("closed")});var locationHref=window.location.href,startIndex=locationHref.indexOf("/",10),endIndex=locationHref.indexOf(".html"),navHref=locationHref.substring(startIndex+1,endIndex),tik=getParam("project_type_id");$(".ns_nav a").each(function(a){var b=this.getAttribute("data-target");navHref.indexOf(b)>=0?$(this).parent().addClass("on").siblings().removeClass("on"):$(this).parent().addClass("on").siblings().removeClass("on")}),$(".nav h3:eq(0)").addClass("on").siblings().removeClass("on"),$(".nav a").each(function(a){var b=this.getAttribute("data-target");navHref==b&&$(this).parent().addClass("on").siblings().removeClass("on")}),$(document).on("mouseenter",".ns_card a",function(){$(this).append("<i></i>")}),$(document).on("mouseleave",".ns_card a",function(){$(this).find("i").remove()}),$(document).on("mouseenter",".bill_tab span",function(){$(this).find("i").show()}),$(document).on("mouseleave",".bill_tab span",function(){$(this).find("i").hide()}),$(document).on("click",".userType .addbtn",function(){$("#modalUserType").modal("open")}),$(document).on("click","#modalUserType, #modalUserType .closed",function(){$("#modalUserType").modal("closed")}),$(document).on("click",".packageType .addbtn",function(){var a=$(".userType .bill_tab span.on").length;a>0?$("#modalPackageType").modal("open"):alert("请选择一个【上网类型】！没有【上网类型】，请新增一个！")}),$(document).on("click","#modalPackageType, #modalPackageType .closed",function(){$("#modalPackageType").modal("closed")}),$(document).on("click","#modalPackageType .adsnav li",function(){var a=$(this).index();$(this).addClass("on").siblings().removeClass("on"),a>0?($(".vtime input").removeClass("checkFloat").addClass("checkInt"),$(".vtime input").attr("placeholder","输入天数").val("")):($(".vtime input").removeClass("checkInt").addClass("checkFloat"),$(".vtime input").attr("placeholder","支持两位小数，例如：1.52").val("")),$(".vtime .errormsg").remove(),$(".vtime input").removeClass("error")}),$(document).on("click","#modalPackageType .add",function(){var a=$(".userType .bill_tab span.on").attr("data-user-type-id"),b=$("#modalPackageType .adsnav li.on").index(),c=$(".userType span.on").index(),d=$("input[name=price]").val(),e=$("input[name=time]").val(),f=""==$("input[name=ends]").val()?2:$("input[name=ends]").val(),g=$("input[name=expired]").val(),h=$("input[name=label]").val();if(0==checkInput($("#modalPackageType .verify"))){var i={location:$("#location").val(),price:d,ends:f,expired:g,label:h,web_type_id:a};0==c&&(i.isguest=1),b>0?(i.time=24*e,i.mask=2):(i.time=e,i.mask=1),billAjax("post",i,function(a){if(200==a.code){if($("#modalPackageType").modal("closed"),""==h)if(b>0)var c='<span data-pay-id="'+a.pay_policy_id+'">'+d+"元 = "+e+"天<i></i></span>";else var c='<span data-pay-id="'+a.pay_policy_id+'">'+d+"元 = "+e+"小时<i></i></span>";else var c='<span data-pay-id="'+a.pay_policy_id+'">'+h+"<i></i></span>";$(".packageType .bill_tab").append(c)}})}}),$(document).on("click",".packageType span i",function(a){a.stopPropagation();var b=$(this),c=$(this).parent().attr("data-pay-id");confirm("确定要删除？")&&billAjax("delete",{pay_policy_id:c},function(a){200==a.code&&b.parent().remove()})}),$(document).on("click",".userType .bill_tab span",function(){var a=$(this).attr("data-user-type-id"),b=$(this);billAjax("get",{web_type_id:a},function(a){if(200==a.code){b.addClass("on").siblings().removeClass("on");for(var c="",d=0,e=a.policys.length;e>d;d++){if(""==a.policys[d].label)if(2==a.policys[d].mask)var f='<span data-pay-id="'+a.policys[d].id+'">'+a.policys[d].price+"元 = "+a.policys[d].time/24+"天<i></i></span>";else var f='<span data-pay-id="'+a.policys[d].id+'">'+a.policys[d].price+"元 = "+a.policys[d].time+"小时<i></i></span>";else var f='<span data-pay-id="'+a.policys[d].id+'">'+a.policys[d].label+"<i></i></span>";c+=f}$(".packageType .bill_tab").html(c)}})}),$(document).on("click","#modalUserType .add",function(){var a=$("input[name=nameType]").val(),b=parseInt($("#userTypeLen").val()),c=$("#location").val();if(0==checkInput($(this).parent().parent())){var d={location:c,name:a};billWebTypeFunc("post",d,function(c){if(200==c.code){$("#modalUserType").modal("closed");var d='<span data-user-type-id="'+c.web_type_id+'">类型'+(b+1)+"："+a+"<i></i></span>";$(".userType .bill_tab").append(d),$("#userTypeLen").val(b+1)}})}}),$(document).on("click",".userType span i",function(a){a.stopPropagation();var b=$(this),c=$(this).parent().index();confirm("确定要删除？")&&c>0&&billWebTypeFunc("delete",{web_type_id:$(this).parent().attr("data-user-type-id")},function(a){200==a.code&&(b.hasClass("on")&&$(".packageType .bill_tab").empty(),b.parent().remove())})}),$(document).on("click","#modalpay .edit",function(){var a=$("#location").val(),b=$("input[name=id]").val(),c=$("input[name=pid]").val(),d=$("input[name=skey]").val(),e=$("#rsakey").siblings("input[name=rsa]").val();if(0==checkInput($("#modalpay .veright"))){var f={location:a,seller_id:b,partner:c,key:d,rsa_private_key_url:e,platform:$("#payHid").val()};payFunc(f,function(a){200==a.code?($("#alipay div span").text(b),$("input[name=id]").parent().parent().data("value",b),$("input[name=pid]").parent().parent().data("value",c),$("input[name=key]").parent().parent().data("value",d),$("input[name=rsa]").parent().parent().data("value",e),$("#modalpay").modal("closed")):console.log(a)})}}),$(document).on("click","#alipay div button",function(){$("#payHid").val("alipay"),$("#modalpay .veright").each(function(a,b){var c=$(b).data("value");!$(b).find("input[type=file]").length>0&&$(b).find("input").val(c)}),$("#modalpay").modal("open")}),$(document).on("click","#modalpay, #modalpay .closed",function(){$("#modalpay").modal("closed")}),$(document).on("change",".profile",function(){uploadfile($(this).attr("id"))}),$("#uploadfile").on("click",function(a){a.preventDefault(),$("#xlsfile").trigger("click")});var fileInt;$(".xlsfile").change(function(){clearTimeout(fileInt);var a=$("#location").val(),b=$(this).attr("id"),c=$(this).parent(),d='<em style="color:#67d58e;"><i class="loading"></i>正在上传...</em>';c.append(d),$.ajaxFileUpload({type:"post",url:proUrl+"user_template",data:{location:a},secureuri:!1,fileElementId:b,dataType:"json",success:function(a,b){window.location.reload()},error:function(a,b,c){console.log(c)}})});var checkImgNone=function(a){var b=$(a).attr("src");"None"==b&&$(a).attr("src","/static/images/cover/defaultImg.jpg")};checkImgNone(".surveyImg img"),$(".protab .tabimg img").map(function(a,b){checkImgNone(b);var c,d,e,f=290;$("<img/>").attr("src",$(b).attr("src")).load(function(){c=this.width,d=this.height,c>=f&&($(b).css("width",f+"px"),e=Math.floor(f*d/c),92>e&&$(b).css("height","92px"))})}),$(".pubtab .tabimg img").each(function(a,b){var c;$("<img/>").attr("src",$(b).attr("src")).load(function(){c=this.width,c>=200&&$(b).css("height","220px")})}),$(document).on("click",".veright img",function(){$("#modalImg img").attr("src",$(this).attr("src")),$("#modalImg").modal("open")}),$(document).on("click","#modalImg, #modalImg .closed",function(){$("#modalImg").modal("closed")}),$(document).on("click",".file button",function(a){a.preventDefault(),$(this).prev("input").trigger("click")}),$("#uploadImg").change(function(){return $(".loading").show(),$.ajaxFileUpload({url:proUrl+"message/image",secureuri:!1,fileElementId:"uploadImg",success:function(a,b){$(".loading").hide();var c=$(a).find("body").text(),d=$.parseJSON(c);$(".imgVal").val(d.name),$(".showImg img").attr("src",cmsUrl+d.name),$(".showImg").show()},error:function(a,b,c){console.log(c)}}),!1}),$(document).on("click",".deluploadImg",function(){$(this).parent().prev().find("input:eq(0)").val(""),$(this).prev("img").attr("src",""),$(this).parent().hide()}),$(".proImg").change(function(){ajaxImg($(this).attr("id"),$(this).attr("imgElementId"),$(this))}),$(document).on("click",".proUserCls",function(){var a=$(this).index();$(".proMobileCls").eq(a).show().siblings().hide(),$(".news").eq(a).show().siblings(".news").hide(),$(this).addClass("on").siblings().removeClass("on")}),$(".sel_date:eq(0)").show(),$(document).on("change",".dateorhour",function(){var a=$(this).val();$(".sel_date").eq(a).show().siblings(".sel_date").hide()}),$(document).on("click","#cmpTime",function(){var a=$(".dateorhour").val();if(0==a)var b=$("#datepicker").val(),c="date="+b;else var d=$("#dateStart").val(),e=$("#dateEnd").val(),c="start="+d+"&end="+e;myLine=echarts.init(document.getElementById("chartLineContent"),"macarons"),myLine.showLoading(),$.ajax({method:"get",url:proUrl+"aps/stat/?"+c,dataType:"json",success:function(b){myLine.hideLoading();var c=getStat(b.stat,a);opLine(c.b,c.c,c.d,c.a,a)}})}),$(document).on("click","#aclist .edit",function(){var a=$(this).parent().parent().find("td"),b=$(this).siblings("input[name=id]").val(),c=$(this).parent().parent().index();$("#modalAC .fill").each(function(b,c){$(c).val(a.eq(b).data("value"))}),$("#modalAC #mask").val(a.eq(-1).find("input[name=mask]").val()),$("#modalAC input[name=secret]").val(a.eq(-1).find("input[name=secret]").val()),$("#modalAC #pid").val(b),$("#modalAC #idx").val(c),$("#modalAC h3").text("编辑AC"),$("#modalAC .btngroups").html('<button type="button" class="btnBlue save">保存</button>'),$("#modalAC").modal("open")}),$(document).on("click","#aclist .add",function(){$("#modalAC h3").text("新增AC"),$("#modalAC .btngroups").html('<button type="button" class="btnBlue add">确定</button>'),$("#modalAC").modal("open")}),$(document).on("click","#modalAC, #modalAC .closed",function(){$("#modalAC").modal("closed")}),$(document).on("click","#modalAC .save",function(){var a=$("#idx").val(),b=$("#mask").val(),c=$("#modalAC input[name=secret]").val();if(0==checkInput($(this).parent().parent())){var d={name:$("input[name=name]").val(),ip:$("input[name=ip]").val(),vendor:$("#vendor").val(),model:$("input[name=model]").val(),user:$("input[name=user]").val(),password:$("input[name=password]").val(),pri:$("#pri").val(),ac_id:$("#pid").val(),mask:b,secret:c};acAjax("put",d,function(d){200==d.code&&($("#modalAC .fill").each(function(b,c){$("#aclist table tr").eq(a).find("td").eq(b).data("value",$(c).val()),$(c).is("select")?$("#aclist table tr").eq(a).find("td").eq(b).html(changeSelectFunc($(c).attr("id"),$(c).val())):"password"==$(c).attr("name")?($("#aclist table tr").eq(a).find("td").eq(b).data("tip",$(c).val()),$("#aclist table tr").eq(a).find("td").eq(b).text("***")):$("#aclist table tr").eq(a).find("td").eq(b).text($(c).val())}),$("#aclist table tr").eq(a).find("td").eq(-1).find("input[name=mask]").val(b),$("#aclist table tr").eq(a).find("td").eq(-1).find("input[name=secret]").val(c),$("#modalAC").modal("closed"))})}}),$(document).on("click","#modalAC .add",function(){var a=$("input[name=name]").val(),b=$("input[name=ip]").val(),c=$("#vendor").val(),d=$("input[name=model]").val(),e=$("input[name=user]").val(),f=$("input[name=password]").val(),g=$("#pri").val(),h=$("#mask").val(),i=$("#modalAC input[name=secret]").val();if(0==checkInput($(this).parent().parent())){var j={name:a,ip:b,vendor:c,model:d,user:e,password:f,pri:g,mask:h,secret:i};acAjax("post",j,function(j){if(200==j.code){var k='<tr><td data-value="'+a+'">'+a+'</td><td data-value="'+b+'">'+b+'</td><td data-value="'+c+'">'+changevendor(c)+'</td><td data-value="'+d+'">'+d+'</td><td data-value="'+e+'">'+e+'</td><td data-value="'+f+'">'+f+'</td><td data-value="'+g+'">'+(0==g?"否":"是")+'</td><td><span class="edit">编辑</span><span class="delete">删除</span><input type="hidden" value="'+j.ac_id+'" name="id" /><input type="hidden" value="'+h+'" name="mask" /><input type="hidden" value="'+i+'" name="secret" /></td></tr>';$("#aclist table tr:eq(0)").after(k),$("#modalAC").modal("closed")}})}}),$(document).on("click","#aclist .delete",function(){var a=$(this);confirm("确定要删除吗?")&&acAjax("delete",{ac_id:$(this).parent().find("input[name=id]").val()},function(b){200==b.code?a.parent().parent().fadeOut(function(){$(this).remove()}):alert("删除失败！")})});var selop=$(".selHid").prop("outerHTML");$(document).on("click","#aplist .edit",function(){for(var a=$(this).parent().parent().find("td"),b=0;b<a.length-1;b++){var c=a.eq(b);1==b&&c.html('<div class="autoInput" title="'+c.attr("data-title")+'" data-locate="'+c.attr("data-value")+'"><em>'+c.attr("data-title")+"</em></div>"),4==b&&c.html('<input type="text" value="'+c.data("value")+'" style="width:250px;" />')}a.eq(a.length-1).find("span").hide(),a.eq(a.length-1).find("button").show()}),$(document).on("click","#aplist .cancel",function(){for(var a=$(this).parent().parent().find("td"),b=0;b<a.length-1;b++){var c=a.eq(b);1==b&&c.html(c.attr("data-title")),4==b&&c.html(c.data("value"))}a.eq(a.length-1).find("button").hide(),a.eq(a.length-1).find("span").show()}),$(document).on("click","#aplist .save",function(){var a=$(this).parent().parent().find("td"),b=a.eq(1).find("div em").text(),c=a.eq(1).find(".autoInput").attr("data-locate"),d=a.eq(0).data("value"),e=a.eq(4).find("input").val(),f={location:c,mac:d,position:e};apAjax(f,function(d){if(200==d.code){for(var f=0;f<a.length-1;f++){var g=a.eq(f);1==f&&(g.html(b),g.attr("data-title",b),g.attr("data-value",c)),4==f&&(g.html(e),g.data("value",e))}a.eq(a.length-1).find("button").hide(),a.eq(a.length-1).find("span").show()}else console.log(d)})}),$(document).on("click","#apslist .edit",function(){for(var a=$(this).parent().parent().find("td"),b=0;b<a.length-1;b++){var c=a.eq(b);4==b&&c.html('<input type="text" value="'+c.data("value")+'" style="width:250px;" />')}a.eq(a.length-1).find("span").hide(),a.eq(a.length-1).find("button").show()}),$(document).on("click","#apslist .cancel",function(){for(var a=$(this).parent().parent().find("td"),b=0;b<a.length-1;b++){var c=a.eq(b);4==b&&c.html(c.data("value"))}a.eq(a.length-1).find("button").hide(),a.eq(a.length-1).find("span").show()}),$(document).on("click","#apslist .save",function(){var a=$(this).parent().parent().find("td"),b=a.eq(0).data("value"),c=a.eq(4).find("input").val(),d=$("#location").val(),e={location:d,mac:b,position:c};apAjax(e,function(b){if(200==b.code){for(var d=0;d<a.length-1;d++){var e=a.eq(d);4==d&&(e.html(c),e.data("value",c))}a.eq(a.length-1).find("button").hide(),a.eq(a.length-1).find("span").show()}else console.log(b)})}),$(document).on("click","#fiberlist .add",function(){$("#modalFiber h3").text("新增宽带"),$("#modalFiber .btngroups").html('<button type="button" class="btnBlue add">确定</button>'),$("#modalFiber").modal("open")}),$(document).on("click","#fiberlist .edit",function(){var a=$(this).parent().parent().find("td"),b=$(this).siblings("input").val(),c=$(this).parent().parent().index();$("#modalFiber .veright input").each(function(b,c){$(c).val(a.eq(b).data("value"))}),$("#modalFiber #pid").val(b),$("#modalFiber #idx").val(c),$("#modalFiber h3").text("编辑宽带"),$("#modalFiber .btngroups").html('<button type="button" class="btnBlue save">保存</button>'),$("#modalFiber").modal("open")}),$(document).on("click","#modalFiber, #modalFiber .closed",function(){$("#modalFiber").modal("closed")}),$(document).on("click","#modalFiber .save",function(){var a=$("#modalFiber #idx").val();if(0==checkInput($("#modalFiber .veright"))){var b={type_id:$("#fiberlist .adsnav li.on").data("id"),line:$("input[name=line]").val(),start:$("input[name=start]").val(),end:$("input[name=end]").val(),telecom:$("input[name=telecom]").val(),fiber_id:$("#modalFiber #pid").val()};fiberAjax("put",b,function(b){200==b.code?($("#modalFiber .veright input").each(function(b,c){$("#fiberlist table tr").eq(a).find("td").eq(b).data("value",$(c).val()),$("#fiberlist table tr").eq(a).find("td").eq(b).text($(c).val())}),$("#modalFiber").modal("closed")):console.log(b)})}}),$(document).on("click","#modalFiber .add",function(){var a=$("input[name=line]").val(),b=$("input[name=start]").val(),c=$("input[name=end]").val(),d=$("input[name=telecom]").val();if(0==checkInput($("#modalFiber .verify"))){var e={type_id:$("#fiberlist .adsnav li.on").data("id"),line:a,start:b,end:c,telecom:d};fiberAjax("post",e,function(e){if(200==e.code){var f='<tr><td data-value="'+a+'">'+a+'</td><td data-value="'+b+'">'+b+'</td><td data-value="'+c+'">'+c+'</td><td data-value="'+d+'">'+d+'</td><td><span class="edit">编辑</span><span class="delete">删除</span><input type="hidden" value="'+e.fiber_id+'" /></td></tr>';$("#fiberlist table tr:eq(0)").after(f),$("#modalFiber").modal("closed")}else console.log(e)})}}),$(document).on("click","#fiberlist .delete",function(){var a=$(this);confirm("确定要删除吗?")&&fiberAjax("delete",{fiber_id:$(this).siblings("input").val()},function(b){200==b.code?a.parent().parent().fadeOut(function(){$(this).remove()}):console.log(b)})}),$(document).on("click","#fiberlist .adsnav li",function(){var a=$(this);a.hasClass("on")||fiberAjax("get",{type_id:a.data("id")},function(b){if(200==b.code){a.addClass("on").siblings().removeClass("on");for(var c=b.fibers.length,d="",e=0;c>e;e++){var f='<tr><td data-value="'+b.fibers[e].line+'">'+b.fibers[e].line+'</td><td data-value="'+b.fibers[e].start+'">'+b.fibers[e].start+'</td><td data-value="'+b.fibers[e].end+'">'+b.fibers[e].end+'</td><td data-value="'+b.fibers[e].telecom+'">'+b.fibers[e].telecom+'</td><td><span class="edit">编辑</span><span class="delete">删除</span><input type="hidden" value="'+b.fibers[e].id+'" /></td></tr>';d+=f}$("#fiberlist table tr:gt(0)").remove(),$("#fiberlist table").append(d)}else console.log(b)})}),$(document).on("click","#pnlist .edit",function(){var a=$(this).parent().parent(),b=a.index(),c=$(this).siblings("input").val();$("#pid").val(c),$("#idx").val(b),$("#pri").val(a.find("td:eq(1) input").val()),$("#policy").val(a.find("td:eq(2) input").val()),$("input[name=ssid]").val(a.find("td:eq(3)").text()),$("input[name=note]").val(a.find("td:eq(4)").text()),$("input[name=portal]").val(a.find("td:eq(5)").text()),$("input[name=appid]").val(a.find("td:eq(6)").text()),$("input[name=shopid]").val(a.find("td:eq(7)").text()),$("input[name=secret]").val(a.find("td:eq(8)").text()),$("#modalPn h3").text("编辑网络配置"),$("#modalPn .btngroups").html('<button type="button" class="btnBlue" id="edit">保存</button>'),$("#modalPn").modal("open")}),$(document).on("click","#modalPn #edit",function(){var a=$("#idx").val(),b=$("#pri").val(),c=$("#pri option:selected").text(),d=$("#policy").val(),e=$("#policy option:selected").text(),f=$("input[name=ssid]").val(),g=$("input[name=note]").val(),h=$("input[name=portal]").val(),i=$("input[name=appid]").val(),j=$("input[name=shopid]").val(),k=$("input[name=secret]").val();return 0!=checkInput($(this).parent().parent())?($("#modalPn .msg").text("填写ssid"),!1):void $.ajax({method:"put",url:proUrl+"pns/",dataType:"json",data:{policy_id:$("#pid").val(),ispri:b,policy:d,ssid:f,note:g,portal:h,appid:i,shopid:j,secret:k},success:function(l){200==l.code?($("#modalPn").modal("closed"),$("#pnlist table tr").eq(a).find("td:eq(1)").html(c+'<input type="hidden" value="'+b+'" />'),
$("#pnlist table tr").eq(a).find("td:eq(2)").html(e+'<input type="hidden" value="'+d+'" />'),$("#pnlist table tr").eq(a).find("td:eq(3)").text(f),$("#pnlist table tr").eq(a).find("td:eq(4)").text(g),$("#pnlist table tr").eq(a).find("td:eq(5)").text(h),$("#pnlist table tr").eq(a).find("td:eq(6)").text(i),$("#pnlist table tr").eq(a).find("td:eq(7)").text(j),$("#pnlist table tr").eq(a).find("td:eq(8)").text(k)):alert("编辑失败")}})}),$(document).on("click","#pnlist .addbtn",function(){$("#modalPn h3").text("新增网络配置"),$("#modalPn .btngroups").html('<button type="button" class="btnBlue" id="add">确定</button>'),$("#modalPn").modal("open")}),$(document).on("click","#modalPn, #modalPn .closed",function(){$("#modalPn").modal("closed")}),$(document).on("click","#modalPn #add",function(){var a=$("#location").val(),b=$("#resourceId").val(),c=$("#pri").val(),d=$("#policy").val(),e=$("input[name=ssid]").val(),f=$("input[name=note]").val(),g=$("input[name=portal]").val(),h=$("input[name=appid]").val(),i=$("input[name=shopid]").val(),j=$("input[name=secret]").val();0==checkInput($(this).parent().parent())&&$.ajax({method:"post",url:proUrl+"pns/",dataType:"json",data:{location:a,ispri:c,policy:d,ssid:e,note:f,portal:g,appid:h,shopid:i,secret:j},success:function(a){if(200==a.code){$("#modalPn").modal("closed");var k="<tr><td>"+b+"</td><td>"+c==0?"否":'是<input type="hidden" value="'+c+'" /></td><td>'+d==0?"收费":'免费<input type="hidden" value="'+d+'" /></td><td>'+e+'</td><td class="wb">'+f+"</td><td>"+g+'</td><td class="wb">'+h+'</td><td class="wb">'+i+'</td><td class="wb">'+j+'</td><td><span class="edit">编辑</span><span class="delete">删除</span><input type="hidden" value="'+a.policy_id+'" /></td></tr>';$("#pnlist table tr:eq(0)").after(k)}else alert("新增失败")}})}),$(document).on("click","#pnlist .delete",function(){var a=$(this).parent().find("input").val(),b=$(this);confirm("确定要删除吗?")&&$.ajax({method:"delete",url:proUrl+"pns/?policy_id="+a,dataType:"json",success:function(a){200==a.code?(b.parent().parent().fadeOut(function(){$(this).remove()}),alert("删除成功！")):alert("删除失败！")}})}),$(document).on("click","#policylist .smore",function(){var a=$(this).parent().parent().next(".insideTable").find("div");a.is(":hidden")?($(this).parent().parent().next(".insideTable").find("div").slideDown(),$(this).html('收起<i class="aUp"></i>')):($(this).parent().parent().next(".insideTable").find("div").slideUp(),$(this).html('展开<i class="aDwn"></i>'))}),$(document).on("click","#policylist .edit",function(){var a=$(this).parent().parent(),b=a.index(),c=a.parent().parent().parent().parent().parent(".insideTable").index(),d=$(this).siblings("input.id").val();$("#pid").val(d),$("#idx").val(b),$("#iidx").val(c),$("#pri").val(a.find("td:eq(1) input").val()),$("#policy").val(a.find("td:eq(2) input").val()),$("input[name=ssid]").val(a.find("td:eq(3)").text()),$("input[name=note]").val(a.find("td:eq(4)").text()),$("input[name=portal]").val(a.find("td:eq(5)").text()),$("input[name=appid]").val($(this).siblings(".appid").val()),$("input[name=shopid]").val($(this).siblings(".shopid").val()),$("input[name=secret]").val($(this).siblings(".secret").val()),$("#modalPn h3").text("编辑网络配置"),$("#modalPn .btngroups").html('<button type="button" class="btnBlue" id="edit">保存</button>'),$("#modalPn").modal("open")}),$(document).on("click","#modalPn #edit",function(){var a=$("#idx").val(),b=$("#iidx").val(),c=$("#pri").val(),d=$("#pri option:selected").text(),e=$("#policy").val(),f=$("#policy option:selected").text(),g=$("input[name=ssid]").val(),h=$("input[name=note]").val(),i=$("input[name=portal]").val(),j=$("input[name=appid]").val(),k=$("input[name=shopid]").val(),l=$("input[name=secret]").val();return 0!=checkInput($(this).parent().parent())?($("#modalPn .msg").text("填写ssid"),!1):void $.ajax({method:"put",url:proUrl+"pns/",dataType:"json",data:{policy_id:$("#pid").val(),ispri:c,policy:e,ssid:g,note:h,portal:i,appid:j,shopid:k,secret:l},success:function(m){200==m.code?($("#modalPn").modal("closed"),""==$("#iidx").val()?($("#policylist table tr").eq(b).find("div table tr").eq(a).find("td:eq(1)").html(d+'<input type="hidden" value="'+c+'" />'),$("#policylist table tr").eq(b).find("div table tr").eq(a).find("td:eq(2)").html(f+'<input type="hidden" value="'+e+'" />'),$("#policylist table tr").eq(b).find("div table tr").eq(a).find("td:eq(3)").text(g),$("#policylist table tr").eq(b).find("div table tr").eq(a).find("td:eq(4)").text(h),$("#policylist table tr").eq(b).find("div table tr").eq(a).find("td:eq(5)").text(i),$("#policylist table tr").eq(b).find("div table tr").eq(a).find("td:eq(6) .appid").text(j),$("#policylist table tr").eq(b).find("div table tr").eq(a).find("td:eq(6) .shopid").text(k),$("#policylist table tr").eq(b).find("div table tr").eq(a).find("td:eq(6) .secret").text(l)):($("#pnlist table tr").eq(a).find("td:eq(1)").html(d+'<input type="hidden" value="'+c+'" />'),$("#pnlist table tr").eq(a).find("td:eq(2)").html(f+'<input type="hidden" value="'+e+'" />'),$("#pnlist table tr").eq(a).find("td:eq(3)").text(g),$("#pnlist table tr").eq(a).find("td:eq(4)").text(h),$("#pnlist table tr").eq(a).find("td:eq(5)").text(i),$("#pnlist table tr").eq(a).find("td:eq(6)").text(j),$("#pnlist table tr").eq(a).find("td:eq(7)").text(k),$("#pnlist table tr").eq(a).find("td:eq(8)").text(l))):alert("编辑失败！")},error:function(a){alert("编辑失败！")}})}),$(document).on("click","#policylist .delete",function(){var a=$(this).parent().find("input.id").val(),b=$(this);confirm("确定要删除吗?")&&$.ajax({method:"delete",url:proUrl+"pns/?policy_id="+a,dataType:"json",success:function(a){200==a.code?(b.parent().parent().fadeOut(function(){$(this).remove()}),alert("删除成功！")):alert("删除失败！")}})}),$(document).on("click","#addFields",function(){if(0==checkIpu($(".innerTable"))||2==$(".innerTable tr").length){var a='<tr><td><i class="uncheck_s on"></i></td><td><input type="text" class="title" /></td><td><input type="text" class="column matchVerify checkEng" /></td><td><select class="extype"><option value="string">字符串(String)</option><option value="int">整型(Int)</option><option value="float">浮点型(Float)</option><option value="datetime">日期(Date)</option><option value="password">密码(Password)</option><option value="img">图片(Img)</option></select></td></tr>';$(".innerTable table").append(a)}});var exfield=!1;$(document).on("change","#resId",function(){8==$(this).val()?($(".exfields").show(),exfield=!0):($(".exfields").hide(),$(".exfields .errormsg").remove(),exfield=!1)}),$(document).on("click","#addRes",function(){var a=$("#location").val(),b=[{type:"string",column:"mobile",title:"电话号码",is_profile:1}],c=[{type:"string",column:"room",title:"房间号",is_profile:1},{type:"string",column:"mobile",title:"电话号码",is_profile:1},{type:"string",column:"user",title:"上网账号",is_profile:1},{type:"password",column:"password",title:"密码",is_profile:1},{type:"datetime",column:"expired",title:"到期时间",is_profile:1}];if(checkInput($(".veright"))>0)return!1;exfield&&($(".exfields .innerTable table tr:gt(1)").each(function(a,c){var d={};0==checkIpu($(c))&&(d.title=$(c).find(".title").val(),d.type=$(c).find(".extype").val(),d.column=$(c).find(".column").val(),d.is_profile=$(c).find("i").hasClass("on")?1:0,b.push(d))}),c=b);var d={location:a,type_id:$("#resId").val(),note:$("#note").val(),name:$("input[name=resName]").val(),owner:$("input[name=resOwner]").val(),mobile:$("input[name=resMobile]").val(),address:$("input[name=resAddress]").val(),logo:$("input[name=resLogo]").val(),license:$("input[name=license]").val(),topology:$("input[name=topology]").val(),tracepoint:$("input[name=tracepoint]").val(),fieldphoto:$("input[name=fieldphoto]").val(),schemes:JSON.stringify(c)};console.log(d),resAjax("post",d,function(b){200==b.code?""==a?window.location.href="/index.html":window.location.href="/projectresource.html?location="+a:console.log(b)})}),$(document).on("click","#editRes",function(){var a=$("#location").val();if(0==checkInput($(".veright"))){var b={location:a,type_id:$("#resId").val(),note:$("#note").val(),name:$("input[name=resName]").val(),owner:$("input[name=resOwner]").val(),mobile:$("input[name=resMobile]").val(),address:$("input[name=resAddress]").val(),logo:$("input[name=resLogo]").val(),license:$("input[name=license]").val(),topology:$("input[name=topology]").val(),tracepoint:$("input[name=tracepoint]").val(),fieldphoto:$("input[name=fieldphoto]").val()};resAjax("put",b,function(b){200==b.code?window.location.href="/projectcard.html?location="+a:console.log(b)})}}),$("#totallist .addbtn").click(function(){$("#modalUser").modal("open")}),$(document).on("click","#modalUser, #modalUser .closed",function(){$("#modalUser").modal("closed")});var userHtml=function(a,b,c,d,e,f){var g="<tr><td>"+a+"</td><td>"+e+"</td><td><span>"+c+"</span>"+f+'<input type="hidden" value="'+b+'" /></td><td>0</td><td>'+d+'</td><td>0</td><td>0</td><td><span class="changePwd">修改密码</span><span class="forbin">禁用</span><span class="delete">删除</span><button type="button" class="btnGrayAutoMin save">保存</button><button type="button" class="btnGrayAutoMin cancel">取消</button><input type="hidden" value="'+a+'" </td></tr>';return g};$(document).on("click","#modalUser #add",function(){var a=$("#projectId").val(),b=$("#projectId option:selected").text(),c=$("#exTime").val(),d=$("#password").val(),e=$("#expassword").val();d!=e?$(".msg").text("两次密码不相同"):($(".msg").html(""),$.ajax({method:"post",url:proUrl+"users/",dataType:"json",data:{project_id:a,expire_date:c,password:d},success:function(e){if(200==e.code){$("#modalUser").modal("closed");var f=userHtml(e.user,a,b,c,d,selop);$("#totallist table tr:eq(0)").after(f)}else $(".msg").text("连接服务器出错")}}))}),$(document).on("click","#totallist .changePwd",function(){var a=$(this).parent().parent().find("td"),b='<input type="text" value="'+a.eq(1).html()+'" /><input type="hidden" value="'+a.eq(1).html()+'" />';a.eq(1).html(b),a.eq(a.length-1).find("span").hide(),a.eq(a.length-1).find("button").show()}),$(document).on("click","#totallist .save",function(){var a=$(this).parent().parent().find("td"),b=$(this).parent().find("input").val(),c=a.eq(1).find("input[type=text]").val();$.ajax({method:"put",url:proUrl+"users/?user="+b,dataType:"json",data:{password:c},success:function(b){200==b.code?(a.eq(1).html(c),a.eq(a.length-1).find("button").hide(),a.eq(a.length-1).find("span").show()):alert("修改密码失败！")}})}),$(document).on("click","#totallist .cancel",function(){var a=$(this).parent().parent().find("td");a.eq(1).html(a.eq(1).find("input[type=hidden]").val()),a.eq(a.length-1).find("button").hide(),a.eq(a.length-1).find("span").show()}),$(document).on("click","#totallist .delete",function(){var a=$(this).parent().find("input").val(),b=$(this);confirm("确定要删除吗?")&&$.ajax({method:"delete",url:proUrl+"users/?user="+a,dataType:"json",success:function(a){200==a.code?(b.parent().parent().fadeOut(function(){$(this).remove()}),alert("删除成功！")):alert("删除失败！")}})}),$(document).on("click","#export",function(){var a={mask:$("#userlist .adsnav li.on").data("mask"),location:$("#location").val(),start:$(".time #dateStart").data("start"),end:$(".time #dateEnd").data("end"),keyword:$(".toolbox .search input").data("search"),sort:$("#userlist table").data("sort")};$(this).attr("href","/export/onlineusers/?"+$.param(a))}),$(".amount").amount(),$(document).on("click","#userlist .wailink tr:gt(0)",function(){var a=$("#userlist .adsnav li.on").data("mask"),b=$(this).find("td:last-child input").val(),c=$("#location").val();window.location.href="/projectuserinfo.html?mask="+a+"&location="+c+"&user_id="+b}),$(document).on("click","#userlist .add",function(){var a=$("#userlist .adsnav li.on").index();$("#modalRoom h3").text("新增用户"),$("#modalRoom .btngroups").html('<button type="button" class="btnBlue add">提交</button>'),$("#modalRoom input[name=user]").css("display","block").parent().addClass("verify"),$("#modalRoom .vertical").hide(),$("#modalRoom .vertical").eq(a).show(),$("#modalRoom").modal("open")}),$(document).on("click","#modalRoom, #modalRoom .closed",function(){$("#modalRoom").modal("closed")}),$(document).on("click","#modalRoom .add",function(){var a={},b={},c=$("#location").val(),d=$("#userlist .adsnav li.on").data("mask"),e=$("#userlist .adsnav li.on").index(),f=[];$("#modalRoom .vertical").eq(e).find("input").each(function(b,d){var e=$(d).attr("name"),g=$(d).data("type"),h={};"int"==g?a[e]=parseInt($(d).val()):"user"==e?a[e]=lastStr(c)+$(d).val():a[e]=$(d).val(),h.type=g,h.value=a[e],f.push(h)}),a.mask=parseInt(d),b.location=c,b.param=JSON.stringify(a),0==checkInput($("#modalRoom .vertical").eq(e))&&pnUserAjax("post",b,function(a){if(200==a.code){$("#modalRoom").modal("closed");var b="<tr>";$.each(f,function(a,c){if("password"==c.type)var d='<td data-value="'+c.value+'" data-tip="'+c.value+'" class="pwdtip">***</td>';else var d='<td data-value="'+c.value+'">'+c.value+"</td>";b+=d}),b+='<td><span class="edit">编辑</span><span class="forbin">禁用</span><span class="delete">删除</span><input type="hidden" value="'+a.user_id+'" /></td></tr>',$("#userlist table tr:eq(0)").after(b)}else $(".msg").text("新增失败")})}),$(document).on("click","#userlist .edit",function(a){var b=$(this).parent().parent().find("td"),c=$(this).siblings("input").val(),d=$(this).parent().parent().index(),e=$("#userlist .adsnav li.on").index(),f=$("#location").val(),g=$(this);$("#modalRoom .vertical").eq(e).find("input").each(function(a,c){"user"==$("#userlist table tr:eq(0) th").eq(a).attr("column")?"undefined"==typeof g.siblings("input").attr("holder")?($(c).val(b.eq(a).data("value").toString().substr(lastStr(f).length)).css("display","block"),$(c).parent().addClass("verify")):($(c).css("display","none"),$(c).parent().removeClass("verify")):$(c).val(b.eq(a).data("value"))}),$("#modalRoom #pid").val(c),$("#modalRoom #idx").val(d),$("#modalRoom h3").text("编辑用户"),$("#modalRoom .btngroups").html('<button type="button" class="btnBlue save">保存</button>'),$("#modalRoom .vertical").hide(),$("#modalRoom .vertical").eq(e).show(),$("#modalRoom").modal("open"),a.stopPropagation()}),$(document).on("click","#modalRoom .save",function(){var a=$("#location").val(),b={user_id:$("#pid").val(),location:a,mask:$("#userlist .adsnav li.on").data("mask")},c={},d=$("#idx").val(),e=$("#userlist .adsnav li.on").index(),f=[];$("#modalRoom .vertical").eq(e).find("input").each(function(b,d){var e=$(d).attr("name"),g=$(d).data("type"),h={};"int"==g?c[e]=parseInt($(d).val()):"user"==e?c[e]=lastStr(a)+$(d).val():c[e]=$(d).val(),h.type=g,h.value=c[e],f.push(h)}),b.param=JSON.stringify(c),0==checkInput($("#modalRoom .vertical").eq(e).find(".verify"))&&pnUserAjax("put",b,function(a){200==a.code?($("#modalRoom").modal("closed"),$.each(f,function(a,b){$("#userlist table tr").eq(d).find("td").eq(a).data("value",b.value),"password"==b.type?($("#userlist table tr").eq(d).find("td").eq(a).text("***"),$("#userlist table tr").eq(d).find("td").eq(a).data("tip",b.value)):$("#userlist table tr").eq(d).find("td").eq(a).text(b.value)})):$(".msg").text("编辑失败")})}),$(document).on("click","#userlist .delete",function(a){a.stopPropagation();var b=$(this),c=$(this).siblings("input").val(),d=$("#userlist .adsnav li.on").data("mask"),e=$("#location").val();if(confirm("确定删除该用户？")){var f={user_id:c,mask:d,location:e};pnUserAjax("delete",f,function(a){200==a.code&&b.parent().parent().remove()})}}),$(document).on("click","#userlist .forbin",function(a){a.stopPropagation();var b=$(this);if(confirm("确定要停用该用户吗？")){var c={user_id:b.siblings("input").val(),location:$("#location").val(),mask:$("#userlist .adsnav li.on").data("mask"),param:JSON.stringify({enable:1})};pnUserAjax("put",c,function(a){200==a.code?(b.hide().siblings(".unforbin").show(),b.parent().parent().addClass("dab")):console.log(a)})}}),$(document).on("click","#userlist .unforbin",function(a){a.stopPropagation();var b=$(this),c={user_id:b.siblings("input").val(),location:$("#location").val(),mask:$("#userlist .adsnav li.on").data("mask"),param:JSON.stringify({enable:0})};pnUserAjax("put",c,function(a){200==a.code?(b.hide().siblings(".forbin").show(),b.parent().parent().removeClass("dab")):console.log(a)})}),$(document).on("click","#userlist .adsnav li",function(){var a=$(this).data("mask"),b=$("#location").val(),c=$(this);if(c.addClass("on").siblings().removeClass("on"),8>=a){addLoad();var d={location:b,page:1,page_size:50,mask:a};pnUserAjax("get",d,function(c){200==c.code&&($(".widget").html(c.stat),$("#userlist table").html(c.table),$("#userlist .page").html(c.paginate),$("#userlist .toolbox .search input").val(""),$("#userlist .toolbox .search button").remove(),$("#userlist .toolbox .search").append('<button type="button"><i class="searchIcoGray"></i></button>'),$("#userlist table").data("sort",""),1==a?($("#uploadfile, #downloadTmp, #userlist .add").show(),$("#export, #reflow").hide(),$("#userlist table").addClass("wailink")):8==a?($("#export, #reflow").show(),$("#userlist .add, #uploadfile, #downloadTmp").hide(),$("#userlist table").removeClass("wailink")):($("#uploadfile, #downloadTmp, #export, #reflow").hide(),$("#userlist .add").show(),$("#userlist table").addClass("wailink")),$("#userlist").page({url:proUrl+"pn/users/",location:b,mask:a}),$("#userlist").pageSearch({url:proUrl+"pn/users/",location:b,mask:a}),removeLoad())})}else alert("开发中...")});var userinfoFlag=!0;$(document).on("click","#userinfo .edit",function(){userinfoFlag&&($(this).hide().siblings(".quit").show(),$(".sue").each(function(a,b){var c=$(b).data("value");if("ends"==$(b).attr("name"))var d='<div class="amount"><button type="button" class="btnWhiteSmall reduceOne">-</button><input type="text" value="'+c+'" /><button type="button" class="btnWhiteSmall addOne">+</button></div>';else if("datetime"==$(b).data("type"))var d='<div class="verify"><input type="text" class="datepicker matchaVerify shouldVerify" value="'+c+'" /></div>';else if("mobile"==$(b).attr("name"))var d='<div class="verify"><input type="text" class="matchVerify shouldVerify checkPhone" value="'+c+'" /></div>';else if("password"==$(b).data("type")){$(b).removeClass("pwdtip");var d='<div class="verify"><input type="text" value="'+c+'" class="matchVerify shouldVerify" /></div>'}else if("img"==$(b).data("type"))$(b).find(".imginfo").hide(),$(b).find(".file").show(),""!=c&&($(b).find(".file input[type=hidden]").val(c),$(b).find(".showImg img").attr("src",c),$(b).find(".showImg").show());else var d='<div class="verify"><input type="text" value="'+c+'" class="matchVerify shouldVerify" /></div>';$(b).html(d)}),$(".datepicker").datetimepicker({dateFormat:"yy-mm-dd",stepMinute:10}),$(".amount").amount(),userinfoFlag=!1)}),$(document).on("click","#userinfo .save",function(){if(!userinfoFlag){var a={},b={},c=$("#location").val(),d=$("#mask").val(),e=$("#userId").val(),f=[];$(".sue").each(function(b,c){var d=$(c).attr("name"),e=$(c).data("type"),g={};"int"==e?a[d]=parseInt($(c).find("input").val()):"img"==e?a[d]=$(c).find("input[type=hidden]").val():a[d]=$(c).find("input").val(),g.type=e,g.value=a[d],f.push(g)}),b.user_id=e,b.location=c,b.mask=d,b.param=JSON.stringify(a),0==checkInput($(".sue"))&&pnUserAjax("put",b,function(a){200==a.code?($.each(f,function(a,b){$(".sue").eq(a).data("value",b.value),"password"==b.type?$(".sue").eq(a).data("tip",b.value).addClass("pwdtip").text("***"):"img"==b.type?""!=b.value&&($(".sue").eq(a).find(".imginfo").attr("src",b.value).show(),$(".sue").eq(a).find(".file, .showImg").hide()):$(".sue").eq(a).text(b.value)}),$(".quit").hide().siblings(".edit").show(),userinfoFlag=!0):console.log(a)})}}),$(document).on("click","#userinfo .quit",function(){$(".sue").each(function(a,b){userinfoFlag=!0,$(".quit").hide().siblings(".edit").show(),"password"==$(b).data("type")?($(b).text("***"),$(b).addClass("pwdtip")):"img"==$(b).data("type")?($(b).find(".imginfo").show(),$(b).find(".file, .showImg").hide()):$(b).text($(b).data("value"))})});var bill_webType=[],bill_fee=[],bill_platform=[];$(".bill_check span:eq(1), .bill_check span:eq(2), .bill_check span:eq(3)").each(function(i,n){$(n).find("em:gt(0)").each(function(i,n){var id=$(n).parent().attr("id"),arr=eval("bill_"+id);arr.push($(n).data("value"))})}),$(document).on("click","#webType em",function(){var a=$(this).index(),b=$(this).parent().find("em:gt(0).on").length,c=$(this).data("value");0==a?($(this).addClass("on").siblings("em").removeClass("on"),bill_webType=[],$(this).parent().find("em:gt(0)").each(function(a,b){bill_webType.push($(b).data("value"))})):(0==b&&($(this).siblings("em:eq(0)").removeClass("on"),bill_webType=[]),$(this).hasClass("on")&&b>1?($(this).removeClass("on"),bill_webType.splice($.inArray(c,bill_webType),1)):($(this).addClass("on"),bill_webType.push(c)))}),$(document).on("click","#fee em",function(){var a=$(this).index(),b=$(this).parent().find("em:gt(0).on").length,c=$(this).data("value");0==a?($(this).addClass("on").siblings("em").removeClass("on"),bill_fee=[],$(this).parent().find("em:gt(0)").each(function(a,b){bill_fee.push($(b).data("value"))})):(0==b&&($(this).siblings("em:eq(0)").removeClass("on"),bill_fee=[]),$(this).hasClass("on")&&b>1?($(this).removeClass("on"),bill_fee.splice($.inArray(c,bill_fee),1)):($(this).addClass("on"),bill_fee.push(c)))}),$(document).on("click","#platform em",function(){var a=$(this).index(),b=$(this).parent().find("em:gt(0).on").length,c=$(this).data("value");0==a?($(this).addClass("on").siblings("em").removeClass("on"),bill_platform=[],$(this).parent().find("em:gt(0)").each(function(a,b){bill_platform.push($(b).data("value"))})):(0==b&&($(this).siblings("em:eq(0)").removeClass("on"),bill_platform=[]),$(this).hasClass("on")&&b>1?($(this).removeClass("on"),bill_platform.splice($.inArray(c,bill_platform),1)):($(this).addClass("on"),bill_platform.push(c)))}),$(document).on("click","#mode em",function(){var a=$(this).index(),b=$(this).parent().find("em:gt(0).on").length;$(this).data("value");0==a?$(this).addClass("on").siblings("em").removeClass("on"):(0==b&&$(this).siblings("em:eq(0)").removeClass("on"),$(this).hasClass("on")&&b>1?$(this).removeClass("on"):$(this).addClass("on"))}),$(document).on("click","#billSearch",function(){var a={location:$("#location").val()};a.start=$("#dateStart").val(),a.end=$("#dateEnd").val(),bill_webType.length>0&&(a.web_type_id=bill_webType.join(",")),bill_fee.length>0&&(a.fee=bill_fee.join(",")),bill_platform.length>0&&(a.platform=bill_platform.join(",")),billFunc(a,function(a){200==a.code?($(".bill_total span:eq(0) em").text(a.current),$(".bill_total span:eq(1) em").text(a.last),$(".bill_total span:eq(2) em").text(a.total)):console.log(a)})});var checkXY=function(a,b,c,d){var e,f,g={};return 21>a?e=0:a>c-21?(e=c-42,console.log(e)):e=a-21,f=21>b?0:b>d-21?d-42:b-21,g={cx:e,cy:f}},deFlag=!1,deThis,deId=-1,dh,dei=0;$(".ns_deCtx .ns_dedo:eq(0)").show(),$(document).on("click",".deviceNav li",function(){var a=$(this).index(),b=$(".ns_deCtx .ns_dedo").eq(a-1).height();$(".ns_deCtx .ns_dedo").eq(a-1).width();return $(this).hasClass("on")?!1:void(a>0?($(this).addClass("on").siblings().removeClass("on"),$(".ns_deCtx .ns_dedo").eq(a-1).show().siblings().hide(),$(".ns_deCtx .ns_dedo").eq(a-1).css("margin-top",-Math.floor(b/2)+"px"),$(".axy").animate({top:"-84px"},500),$(".ns_xy").animate({height:"60px"},500),$(".ns_xy em").text(""),$(".ns_xy input").each(function(a,b){$(b).val(""),inputError("",b)}),$(".ns_debtns").remove(),$(".donew").remove(),deFlag=!1):alert("开发中..."))}),$(document).on("click",".addap",function(){$(".ns_xy .add").show().siblings(".save").hide(),$(".axy").animate({top:"0"},500),$(".ns_xy").animate({height:"80px"},500),deFlag=!0}),$(document).on("click",".ns_xy .quit",function(){$(".axy").animate({top:"-84px"},500),$(".ns_xy").animate({height:"60px"},500),$(".ns_xy em").text(""),$(".ns_xy input").each(function(a,b){$(b).val(""),inputError("",b)}),$(".donew").remove(),deFlag=!1}),$(document).on("click",".ns_xy .add",function(){var a=$(".deviceNav li.on").index(),b=$(".ns_xy input[name=mac]").val(),c=$(".ns_xy input[name=name]").val(),d=$(".ns_xy input[name=vendor]").val(),e=$("#ix").text(),f=$("#iy").text(),g=$(".ns_dedo").eq(a-1).height(),h=$(".ns_dedo").eq(a-1).width();checkXY(e,f,h,g);if(""==e||""==f)return alert("请点击施工图获取AP坐标"),!1;if(0==checkInput($(".ns_xy span"))){var i='<em data-mac="'+b+'" data-name="'+c+'" data-vendor="'+d+'" data-x="'+e+'" data-y="'+f+'" data-id="'+ ++dei+'"></em>';$(".donew").html(i).removeClass("donew"),$(".ns_xy em").text(""),$(".ns_xy input").each(function(a,b){$(b).val(""),inputError("",b)}),alert("新增成功！")}}),$(document).on("click",".ns_debtns .edit",function(){$(".ns_debtns").remove(),$(".ns_xy .save").show().siblings(".add").hide(),$(".axy").animate({top:"0"},500),$(".ns_xy").animate({height:"80px"},500),$(".ns_xy input[name=mac]").val(deThis.data("mac")),$(".ns_xy input[name=name]").val(deThis.data("name")),$(".ns_xy input[name=vendor]").val(deThis.data("vendor")),$("#ix").text(deThis.data("x")),$("#iy").text(deThis.data("y")),deFlag=!1}),$(document).on("click",".ns_xy .save",function(){0==checkInput($(".ns_xy span"))&&(alert("编辑成功！"),deThis.data("mac",$(".ns_xy input[name=mac]").val()),deThis.data("name",$(".ns_xy input[name=name]").val()),deThis.data("vendor",$(".ns_xy input[name=vendor]").val()),$(".axy").animate({top:"-84px"},500),$(".ns_xy").animate({height:"60px"},500),$(".ns_xy em").text(""),$(".ns_xy input").each(function(a,b){$(b).val(""),inputError("",b)}))}),$(document).on("click",".ns_debtns .delete",function(){confirm("确定要删除此AP？")&&(deThis.parent().remove(),$(".ns_debtns").remove())}),$(document).on("click",".ns_deCtx img",function(a){if($(".ns_debtns").remove(),deFlag){$(".donew").remove();var b=a.offsetX,c=a.offsetY,d=$(this).parent().height(),e=$(this).parent().width();$("#ix").text(b),$("#iy").text(c);var f=checkXY(b,c,e,d),g='<i class="doGreen donew" style="left: '+f.cx+"px;top: "+f.cy+'px;"></i>';$(this).parent().append(g)}}),$(document).on("mouseenter",".ns_dedo em",function(){var a=$(this).parent().position().left+21,b=$(this).parent().position().top+21,c=$(this).parent().parent().height(),d=$(this).parent().parent().width(),e='<div class="ns_deinfo"><i></i><div><label>AP名称：</label><span>'+$(this).data("name")+"</span></div><div><label>品牌：</label><span>"+$(this).data("vendor")+"</span></div><div><label>位置：</label><span>x："+$(this).data("x")+" , y："+$(this).data("y")+"</span></div><div><label>MAC地址：</label><span>"+$(this).data("mac")+"</span></div></div>";$(this).parent().parent().append(e);var f=$(".ns_deinfo").outerWidth(),e=$(".ns_deinfo").outerHeight();f>a?($(".ns_deinfo").css({left:"1px"}),$(".ns_deinfo i").css({left:a+"px"})):a>d-f?($(".ns_deinfo").css({left:d-f-1+"px"}),$(".ns_deinfo i").css({left:f-(d-a)+"px"})):$(".ns_deinfo").css({left:a-f/2+"px"}),b<Math.floor(c/2)?$(".ns_deinfo").css({top:b+21+"px"}):($(".ns_deinfo").css({top:b-e-21+"px"}),$(".ns_deinfo i").css({top:e+"px"}).addClass("down"))}),$(document).on("mouseleave",".ns_dedo em",function(){$(".ns_deinfo").remove()}),$(document).on("click",".ns_dedo em",function(){if(deId==$(this).data("id")&&$(".ns_debtns").length>0)return $(".ns_debtns").remove(),!1;$(".ns_debtns").remove(),deThis=$(this),deId=deThis.data("id");var a=$(this).parent().position().left+21,b=$(this).parent().position().top+21,c=$(this).parent().parent().height(),d=$(this).parent().parent().width(),e='<div class="ns_debtns"><i></i><div><button type="button" class="btnBlueSmall edit">编辑</button><button type="button" class="btnBlueSmall delete">删除</button></div></div>';$(this).parent().parent().append(e);var f=$(".ns_debtns").outerWidth(),e=$(".ns_debtns").outerHeight();a<Math.floor(d/2)?$(".ns_debtns").css({left:a+21+"px"}):($(".ns_debtns").css({left:a-f-21+"px"}),$(".ns_debtns i").css({left:f-2+"px"}).addClass("right")),e/2>b?($(".ns_deinfo").css({top:0}),$(".ns_debtns i").css({top:b+"px"})):b>c-e?($(".ns_debtns").css({top:c-e+"px"}),$(".ns_debtns i").css({top:e-(c-b)+"px"})):$(".ns_debtns").css({top:b-e/2+"px"})})}),function(a){a.fn.extend({modal:function(a){var c=this;b(c,a)}});var b=function(b,c){"open"==c?(a("body").css("padding-right","17px").addClass("modal_open").append('<div class="zhez fade"></div>'),a(b).fadeIn(150,function(){a(this).addClass("in")}),a(".zhez").addClass("in")):"closed"==c&&(a(b).removeClass("in").fadeOut(150),a(b).find("input").each(function(b,c){a(c).val(""),inputError("",c)}),a(".amount input").val(2),a(b).find(".msg").text(""),a(".zhez").removeClass("in"),setTimeout(function(){a(".zhez").remove(),a("body").css("padding-right","0").removeClass("modal_open")},150))};a(document).on("click",".modal .modal_body, .modal .modal_ele img",function(a){a.stopPropagation()})}(jQuery);var params={left:0,top:0,currentX:0,currentY:0,flag:!1},getCss=function(a,b){return a.currentStyle?a.currentStyle[b]:document.defaultView.getComputedStyle(a,!1)[b]},startDrag=function(a,b,c){"auto"!==getCss(b,"left")&&(params.left=getCss(b,"left")),"auto"!==getCss(b,"top")&&(params.top=getCss(b,"top")),a.onmousedown=function(b){params.flag=!0,b||(b=window.event,a.onselectstart=function(){return!1});var c=b;params.currentX=c.clientX,params.currentY=c.clientY},document.onmouseup=function(){params.flag=!1,"auto"!==getCss(b,"left")&&(params.left=getCss(b,"left")),"auto"!==getCss(b,"top")&&(params.top=getCss(b,"top"))},document.onmousemove=function(a){var d=a?a:window.event;if(params.flag){var e=d.clientX,f=d.clientY,g=e-params.currentX,h=f-params.currentY;b.style.left=parseInt(params.left)+g+"px",b.style.top=parseInt(params.top)+h+"px"}"function"==typeof c&&c(parseInt(params.left)+g,parseInt(params.top)+h)}};!function(a){a.fn.amount=function(b){var c=a(this),d={init:function(b){var d={min:1,max:5};this.wrapper=c,this.settings=a.extend(d,b||{}),this.ipu=this.wrapper.find("input"),this.addEvent(),this.reduceEvent(),this.modifyEvent()},addEvent:function(){var a=this;this.wrapper.find(".addOne").on("click",function(){a.val=a.wrapper.find("input").val();var b=a.amountFunc(a.val,!0);b>a.settings.max?a.ipu.val(a.settings.max):a.ipu.val(b)})},reduceEvent:function(){var a=this;this.wrapper.find(".reduceOne").on("click",function(){a.val=a.wrapper.find("input").val();var b=a.amountFunc(a.val,!1);b<a.settings.min?a.ipu.val(a.settings.min):a.ipu.val(b)})},modifyEvent:function(){var a=this;this.ipu.on("change",function(){a.val=a.wrapper.find("input").val(),(!a.reg(a.val)||a.val>a.settings.max||a.val<a.settings.min)&&(alert("仅可支持1-5个终端数"),a.ipu.val(2))})},amountFunc:function(a,b){return this.reg(a)&&(b?a++:a--),a},reg:function(a){return new RegExp("^[0-9]*$").test(a)}};d.init(b)}}(jQuery),function(a){var b={},c=!1;a.fn.page=function(d){var e=a(this),f={init:function(b){var c={url:null,location:null,mask:null,pagesize:50,time:!1,deSearch:!1};this.settings=a.extend(c,b||{}),this.wrapper=e,this.param={page_size:this.settings.pagesize},this.pagecount=parseInt(this.wrapper.find(".pagecount").text()),this.pageDown(),this.pageUp(),this.pageJump(),this.pageSort()},pageDown:function(){var a=this;a.wrapper.find(".next").on("click",function(){var b=parseInt(a.wrapper.find(".nowpage").text()),c=a.pageChange(b,!0);c<=a.pagecount&&a.pageAjax(c,!0)})},pageUp:function(){var a=this;a.wrapper.find(".prev").on("click",function(){var b=parseInt(a.wrapper.find(".nowpage").text()),c=a.pageChange(b,!1);c>0&&a.pageAjax(c,!0)})},pageJump:function(){var a=this;a.wrapper.find(".jump").on("click",function(){var b=parseInt(a.wrapper.find(".pagesize").val());a.reg(b)&&b>0&&b<=a.pagecount?a.pageAjax(b,!0):console.log("error page")})},pageChange:function(a,b){return b?a++:a--,a},pageSort:function(){var d=this;d.wrapper.find("th").on("click",function(){var e=a(this).attr("column"),f=a(this).attr("sort");e&&(b={},b[e]=-1*f,c=!0,d.param.sort=JSON.stringify(b),d.pageAjax(1,!1))})},pageAjax:function(d,e){addLoad();var f=this,g=f.wrapper.find("table").data("sort");f.param.page=d,f.param.keyword=f.wrapper.find(".search input").data("search"),null!=f.settings.location&&(f.param.location=f.settings.location),null!=f.settings.mask&&(f.param.mask=f.settings.mask),c||(""!=g?f.param.sort=g:delete f.param.sort),
a(".toolbox .autoInput").length>0&&(f.param.resource=f.wrapper.find(".toolbox .autoInput").attr("data-locate")),f.settings.time&&(f.param.start=f.wrapper.find(".time #dateStart").data("start"),f.param.end=f.wrapper.find(".time #dateEnd").data("end")),f.settings.deSearch&&f.wrapper.find(".toolbox select").each(function(b,c){var d=a(c).data("name");f.param[d]=a(c).val()}),a.ajax({method:"get",url:f.settings.url,data:f.param,dataType:"json"}).done(function(d){200==d.code?(c&&f.wrapper.find("table").data("sort",JSON.stringify(b)),f.stop=f.wrapper.offset().top,e&&a("body,html").scrollTop(f.stop),f.wrapper.find("table").html(d.table),f.wrapper.find(".page").html(d.paginate),f.wrapper.page({url:f.settings.url,location:f.settings.location,mask:f.settings.mask,pagesize:f.settings.pagesize,time:f.settings.time,deSearch:f.settings.deSearch}),c=!1,removeLoad()):(c=!1,console.log(d))}).fail(function(){c=!1,console.log("翻页失败！")})},reg:function(a){return new RegExp("^[0-9]*$").test(a)}};f.init(d)}}(jQuery),function(a){var b="",c="",d="",e=!0;a.fn.pageSearch=function(f){var g=a(this),h={init:function(b){var c={url:null,location:null,mask:null,pagesize:50,pageUrl:null,time:!1,deSearch:!1};this.settings=a.extend(c,b||{}),this.wrapper=g,this.param={page_size:this.settings.pagesize},this.pageSearch(),this.pageTime(),this.pageDeSearch()},pageSearch:function(){var c=this;c.wrapper.find(".search button").on("click",function(){b=a(this).siblings("input").val(),c.param.keyword=a.trim(b),c.settings.deSearch&&c.wrapper.find(".toolbox select").each(function(b,d){var e=a(d).data("name");c.param[e]=a(d).val()}),c.pageAjax(1,!1)})},pageDeSearch:function(){var b=this;b.wrapper.find(".toolbox select").on("change",function(){b.param.keyword=b.wrapper.find(".search input").data("search"),b.wrapper.find(".toolbox select").each(function(c,d){var e=a(d).data("name");b.param[e]=a(d).val()}),b.pageAjax(1,!1)})},pageTime:function(){var b=this;b.wrapper.find(".timeSearch").on("click",function(){c=a(this).siblings(".time").find("#dateStart").val(),d=a(this).siblings(".time").find("#dateEnd").val(),b.param.start=c,b.param.end=d,e=!1,b.param.keyword=b.wrapper.find(".search input").data("search"),b.settings.deSearch&&b.wrapper.find(".toolbox select").each(function(c,d){var e=a(d).data("name");b.param[e]=a(d).val()}),b.pageAjax(1,!1)})},pageAjax:function(f,g){addLoad();var h=this,i=h.wrapper.find("table").data("sort");h.param.page=f,null!=h.settings.location&&(h.param.location=h.settings.location),null!=h.settings.mask&&(h.param.mask=h.settings.mask),""!=i&&(h.param.sort=i),a(".toolbox .autoInput").length>0&&(h.param.resource=h.wrapper.find(".toolbox .autoInput").attr("data-locate")),e&&h.settings.time&&(h.param.start=h.wrapper.find(".time #dateStart").data("start"),h.param.end=h.wrapper.find(".time #dateEnd").data("end")),a.ajax({method:"get",url:h.settings.url,data:h.param,dataType:"json"}).done(function(f){200==f.code?(h.wrapper.find(".search input").data("search",a.trim(b)),h.wrapper.find(".time #dateStart").data("start",c),h.wrapper.find(".time #dateEnd").data("end",d),h.stop=h.wrapper.offset().top,g&&a("body,html").scrollTop(h.stop),h.wrapper.find("table").html(f.table),h.wrapper.find(".page").html(f.paginate),h.wrapper.page({url:null==h.settings.pageUrl?h.settings.url:h.settings.pageUrl,location:h.settings.location,mask:h.settings.mask,pagesize:h.settings.pagesize,time:h.settings.time,deSearch:h.settings.deSearch}),removeLoad()):(e=!0,console.log(f))}).fail(function(){e=!0,console.log("翻页失败！")})},reg:function(a){return new RegExp("^[0-9]*$").test(a)}};h.init(f)}}(jQuery);
/*! nanshacity_v2 JavieChan */