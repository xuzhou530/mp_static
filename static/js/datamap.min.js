/*! nanshacity_v2 author:JavieChan create:2016-01-11 updated:2016-08-15 */
function perfectSize(){var a=$(window).height()-61,b=a>826?a:826,c=Math.floor((b-70-44-10)/2);$(".block").css({height:b+"px"}),$(".blockChartTop, .blockChartBottom, .htq").css({height:c+"px"})}function townVillageRank(a){for(var b=0,c="";b<a.length;b++){var d=a[b],e="<li><span>"+d[0]+"</span><em>"+d[1]+"</em></li>";c+=e}return c}function randomNum(a,b){var c=b-a,d=Math.random(),e=a+Math.round(d*c);return e}function generateData(){var a,b=[],c=(new Date).getTime();for(a=-4;0>=a;a+=1)b.push({x:c+1e3*a,y:Math.round(100*Math.random())+10});return b}function loadPieA(a){var b=a.series[0];intPA=setInterval(function(){var a=[];a.push(["在线",randomNum(566,606)]),a.push(["离线",randomNum(43,83)]),b.setData(a)},3e3)}function loadPieB(a){var b=a.series[0];intPB=setInterval(function(){var a=[];a.push(["空闲=0",randomNum(219,259)]),a.push(["繁忙>5",randomNum(47,87)]),a.push(["其他",randomNum(323,363)]),b.setData(a)},3e3)}function loadPieC(a){var b=a.series[0];intPC=setInterval(function(){var a=[];a.push(["手机",randomNum(357,397)]),a.push(["PC",randomNum(9,49)]),a.push(["其他",randomNum(499,539)]),b.setData(a)},3e3)}function loadLineA(a){var b=a,c=b.series[0],d=b.series[1];intA=setInterval(function(){var a=(new Date).getTime(),b=Math.round(100*Math.random())+10;c.addPoint([a,b+5],!0,!0),d.addPoint([a,b-5],!0,!0)},3e3)}function loadLineB(a){var b=a;intB=setInterval(function(){for(var a=0,c=b.series.length;c>a;a++){var d=b.series[a],e=(new Date).getTime(),f=Math.round(100*Math.random())+10;d.addPoint([e,f],!0,!0)}},3e3)}function loadLineC(a){var b=a;intC=setInterval(function(){for(var a=0,c=b.series.length;c>a;a++){var d=b.series[a],e=(new Date).getTime(),f=Math.round(100*Math.random())+10;d.addPoint([e,f],!0,!0)}},3e3)}function chartAjax(a,b,c){$.ajax({method:"get",url:proUrl+"datamap/"+a,data:{location:77201},dataType:"json"}).done(function(a){b(a)}).fail(function(a){console.log(a),"function"==typeof c&&c()})}var intPA,intPB,intPC,intA,intB,intC,chartFlag=!0,chartA,chartB,chartC,xline,xarea,onlinePieA=[],onlinePieB=[],onlinePieC=[],onlineLineA=[],onlineLineB=[],onlineLineC=[],devicePieA=[],devicePieB=[],devicePieC=[],deviceLineA=[],deviceLineB=[],deviceLineC=[],line30=[],line24=[],area30=[],area24=[],colorStep=["#5dff97","#ff9e04","#e964fd","#e4ff03","#a701fd","#0bb617","#00f6ff","#ff5893","#fff"];$(function(){function a(a,c){if(onlinePieA=[],onlinePieB=[],onlinePieC=[],onlineLineA=[],onlineLineB=[],onlineLineC=[],line30=[],line24=[],area30=[],area24=[],0==c){$("#onlineSlimScroll ul:first").append(townVillageRank(a.town_ap_rank)),$("#onlineSlimScroll ul:last").append(townVillageRank(a.village_ap_rand)),$("#onlineSlimScroll").slimScroll({height:"400px"}),$(".online .blockInfo em:eq(0)").text(a.ap_conns_count),$(".online .blockInfo em:eq(1)").text(a.ap_user_online_count),$(".online .blockInfo em:eq(2)").text(a.ap_total_traffic),$(".online .blockInfo em:eq(3)").text(a.peak_online_user_count),onlinePieA.push(["认证用户",a.auth_status.auth_count],["未认证用户",a.auth_status.unauth_count]),onlinePieB.push(["首次连接",a.conn_times_status.first],["二次连接",a.conn_times_status.second],["三次以上",a.conn_times_status.over]),onlinePieC.push(["1天以内",a.usage_status.one],["1-3天",a.usage_status.third],["3天以上",a.usage_status.over]),onlineLineA.push({name:"认证用户",color:"#00f6ff",data:a.auth_chart_data.auth_chart_data},{name:"未认证用户",color:"#eb64ff",data:a.auth_chart_data.unauth_chart_data}),onlineLineB.push({name:"首次连接",color:"#e4ff00",data:a.conn_times_chart_data.first_chart_data},{name:"二次连接",color:"#eb64ff",data:a.conn_times_chart_data.second_chart_data},{name:"三次以上",color:"#5bff91",data:a.conn_times_chart_data.over_chart_data}),onlineLineC.push({name:"1天以内",color:"#5bff91",data:a.usage_chart_data.one_chart_data},{name:"1-3天",color:"#00f6ff",data:a.usage_chart_data.three_chart_data},{name:"3天以上",color:"#ffeb04",data:a.usage_chart_data.over_chart_data});var d=1;$.each(a.town_conns_chart_data,function(a,b){var c={name:a,color:colorStep[d],data:b};line24.push(c),d++});var e=1;$.each(a.town_day_conns_chart_data,function(a,b){var c={name:a,color:colorStep[e],data:b};line30.push(c),e++}),chartA=new Highcharts.Chart(b.optionPie("onlinePieA",onlinePieA,b.color[0])),chartB=new Highcharts.Chart(b.optionPie("onlinePieB",onlinePieB,b.color[1])),chartC=new Highcharts.Chart(b.optionPie("onlinePieC",onlinePieC,b.color[2])),xline=new Highcharts.Chart(b.optionLineX("Xline",line24))}else 1==c&&($("#deviceSlimScroll ul:first").append(townVillageRank(a.town_ap_rank)),$("#deviceSlimScroll ul:last").append(townVillageRank(a.village_ap_rand)),$("#deviceSlimScroll").slimScroll({height:"400px"}),$(".device .blockInfo em:eq(0)").text(a.ap_total_count),$(".device .blockInfo em:eq(1)").text(a.ap_offline_count),$(".device .blockInfo em:eq(2)").text(a.ap_conns_count),$(".device .blockInfo em:eq(3)").text(a.ap_user_online_count),onlinePieA.push(["在线",a.online_count],["离线",a.offline_count]),onlinePieB.push(["空闲=0",a.idle_count],["繁忙>5",a.busy_count],["其他",a.other_count]),onlinePieC.push(["手机",a.mobile_count],["PC",a.pc_count],["其他",a.other_platform_count]),onlineLineA.push({name:"在线",color:"#00f6ff",data:a.online_chart_data.online},{name:"离线",color:"#eb64ff",data:a.online_chart_data.offline}),onlineLineB.push({name:"空闲=0",color:"#e4ff00",data:a.conns_chart_data.idle},{name:"繁忙>5",color:"#eb64ff",data:a.conns_chart_data.busy},{name:"其他",color:"#5bff91",data:a.conns_chart_data.other}),onlineLineC.push({name:"手机",color:"#5bff91",data:a.platform_chart_data.mobile},{name:"PC",color:"#00f6ff",data:a.platform_chart_data.pc},{name:"其他",color:"#ffeb04",data:a.platform_chart_data.other}),area24.push({name:"用户流量",color:"#276089",lineColor:"#00f6ff",data:traffic_chart_data}),area30.push({name:"用户流量",color:"#276089",lineColor:"#00f6ff",data:day_traffic_chart_data}),chartA=new Highcharts.Chart(b.optionPie("devicePieA",onlinePieA,b.color[0])),chartB=new Highcharts.Chart(b.optionPie("devicePieB",onlinePieB,b.color[1])),chartC=new Highcharts.Chart(b.optionPie("devicePieC",onlinePieC,b.color[2])),xarea=new Highcharts.Chart(b.optionArea("Xarea",area24)))}perfectSize(),Highcharts.setOptions({global:{useUTC:!1}});var b={optionPie:function(a,b,c,d){var e={chart:{renderTo:a,type:"pie",options3d:{enabled:!0,alpha:25},backgroundColor:"transparent",style:{color:"#fff"},events:{load:function(){"function"==typeof d&&d(this)}}},title:{text:""},colors:c,credits:{enabled:!1},tooltip:{formatter:function(){return this.key+": "+this.y}},legend:{itemStyle:{fontSize:"16px",fontWeight:"normal"},itemHoverStyle:{fontSize:"16px",fontWeight:"normal"},symbolRadius:6,symbolWidth:12,symbolHeight:12},plotOptions:{pie:{innerSize:100,depth:15,showInLegend:!0,borderWidth:0},series:{dataLabels:{align:"center",color:"#fff",style:{fontSize:"18px",fontWeight:"normal"},format:"{point.y}",distance:10}}},series:[{data:b}]};return e},optionArea:function(a,b){var c={chart:{type:"area",renderTo:a,backgroundColor:"transparent",spacing:[20,20,20,20]},title:{text:"用户流量统计",style:{color:"#dffeff",fontSize:"16px"},align:"left"},xAxis:{minPadding:0,maxPadding:0,startOnTick:!0,allowDecimals:!1,labels:{style:{color:"#dffeff",fontSize:"16px"}},tickWidth:0,lineColor:"#fff"},yAxis:{title:{text:""},labels:{style:{color:"#dffeff",fontSize:"16px"}},gridLineWidth:0,tickWidth:0,lineWidth:1,lineColor:"#fff"},tooltip:{},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{area:{marker:{enabled:!1,symbol:"circle",radius:2,states:{hover:{enabled:!0}}}}},series:b};return c},optionLine:function(a,b,c){var d={chart:{renderTo:a,type:"spline",backgroundColor:"transparent",spacing:[25,15,5,35],animation:Highcharts.svg,events:{load:function(){"function"==typeof c&&c(this)}}},title:{text:""},xAxis:{type:"datetime",allowDecimals:!1,labels:{style:{color:"#fff",fontSize:"14px"}},tickWidth:0,lineColor:"#fff"},yAxis:{title:{text:"个",align:"high",rotation:0,style:{color:"#fff",fontSize:"14px"},y:-15,offset:15},gridLineWidth:0,tickWidth:0,lineWidth:1,lineColor:"#fff"},credits:{enabled:!1},tooltip:{formatter:function(){return"<b>"+this.x+"点</b><br />"+this.series.name+": "+this.y+"人"}},legend:{itemStyle:{fontSize:"16px",fontWeight:"normal"},itemHoverStyle:{fontSize:"16px",fontWeight:"normal"}},plotOptions:{spline:{marker:{enabled:!1}}},series:b};return d},optionLineX:function(a,b){var c={chart:{renderTo:a,type:"spline",backgroundColor:"transparent",spacing:[20,20,20,20],animation:Highcharts.svg},title:{text:"各镇连接人数实时统计",style:{color:"#dffeff",fontSize:"14px"},align:"left"},xAxis:{allowDecimals:!1,labels:{style:{color:"#dffeff",fontSize:"16px"}},tickWidth:0,lineColor:"#fff"},yAxis:{title:{text:"",style:{color:"#dffeff",fontSize:"16px"},y:-15,offset:15},gridLineWidth:0,tickWidth:0,lineWidth:1,lineColor:"#fff"},credits:{enabled:!1},tooltip:{formatter:function(){return"<b>"+Highcharts.dateFormat("%Y-%m-%d %H:%M:%S",this.x)+"</b><br />"+this.series.name+": "+this.y+"人"}},legend:{itemStyle:{fontSize:"14px",fontWeight:"normal"},itemHoverStyle:{fontSize:"14px",fontWeight:"normal"}},plotOptions:{spline:{marker:{enabled:!1}}},series:b};return c},color:[["#00f6ff","#eb64ff","#e4ff00","#5bff91","#ffeb04"],["#e4ff00","#eb64ff","#5bff91","#ffeb04","#00f6ff"],["#5bff91","#00f6ff","#ffeb04","#eb64ff","#e4ff00"]]};$(document).on("click","header span button",function(){$(".block").is(":hidden")?($(this).addClass("on"),$(".blockCtx").hide(),$(".blockCtx:eq(0)").show(),$(".block").slideDown(500),chartAjax("online",function(b){200==b.code&&a(b,0)})):($(".block").slideUp(500),$(this).removeClass("on"))}),$(document).on("click",".blockNavBtns button",function(){chartFlag=!1;var b=$(this).index(),c=$(this).html();return b>1?!1:($(".blockTab h2").html(c),void($(this).hasClass("on")||($(this).addClass("on").siblings().removeClass("on"),$(".blockCtx").hide(),$(".blockCtx").eq(b).show(),0==b?chartAjax("online",function(b){200==b.code&&a(b,0)}):1==b&&chartAjax("device",function(b){200==b.code&&a(b,1)}))))}),$(document).on("click",".online .changeChart",function(){chartFlag?($(this).text("切换饼图"),chartA=new Highcharts.Chart(b.optionLine("onlinePieA",onlineLineA)),chartB=new Highcharts.Chart(b.optionLine("onlinePieB",onlineLineB)),chartC=new Highcharts.Chart(b.optionLine("onlinePieC",onlineLineC)),chartFlag=!1):($(this).text("切换坐标"),chartA=new Highcharts.Chart(b.optionPie("onlinePieA",onlinePieA,b.color[0])),chartB=new Highcharts.Chart(b.optionPie("onlinePieB",onlinePieB,b.color[1])),chartC=new Highcharts.Chart(b.optionPie("onlinePieC",onlinePieC,b.color[2])),chartFlag=!0)}),$(document).on("click",".device .changeChart",function(){chartFlag?($(this).text("切换饼图"),chartA=new Highcharts.Chart(b.optionLine("devicePieA",onlineLineA)),chartB=new Highcharts.Chart(b.optionLine("devicePieB",onlineLineB)),chartC=new Highcharts.Chart(b.optionLine("devicePieC",onlineLineC)),chartFlag=!1):($(this).text("切换坐标"),chartA=new Highcharts.Chart(b.optionPie("devicePieA",onlinePieA,b.color[0])),chartB=new Highcharts.Chart(b.optionPie("devicePieB",onlinePieB,b.color[1])),chartC=new Highcharts.Chart(b.optionPie("devicePieC",onlinePieC,b.color[2])),chartFlag=!0)}),$(document).on("click",".online .asidebtns button",function(){$(this).addClass("on").siblings().removeClass("on");var a=$(this).index();$(this).hasClass("on")||(xline=0==a?new Highcharts.Chart(b.optionLineX("Xline",line30)):new Highcharts.Chart(b.optionLineX("Xline",line24)))}),$(document).on("click",".device .asidebtns button",function(){$(this).addClass("on").siblings().removeClass("on");var a=$(this).index();$(this).hasClass("on")||(xarea=0==a?new Highcharts.Chart(b.optionArea("Xarea",area30)):new Highcharts.Chart(b.optionArea("Xarea",area24)))}),$(document).on("click",".townVillage button",function(){$(this).addClass("on").siblings().removeClass("on");var a=$(this).index();$(this).parents(".blockRank").find(".slimScroll ul").hide(),$(this).parents(".blockRank").find(".slimScroll ul").eq(a).show()}),$(document).on("mouseenter",".slimScroll li",function(){$(this).prepend('<i class="clickIco"></i>').siblings().find(".clickIco").remove()}),window.onresize=function(){perfectSize(),chartFlag&&(chartA.reflow(),chartB.reflow(),chartC.reflow())},$("#mapNav li").on("click",function(){$(this).addClass("on").siblings().removeClass("on");var a=$(this).data("lnglat").split(",");map.getZoom()<13?map.setZoomAndCenter(13,a):map.panTo(a)})});var proUrl="/";
/*! nanshacity_v2 JavieChan */